<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jewish Mapped</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    
    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f7f8fa;
            color: #2a2a2a;
        }

        /* Header */
        .header {
            background: #fff;
            border-bottom: 1px solid #e5e7eb;
            padding: 12px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: #006ba6;
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            gap: 32px;
            align-items: center;
        }

        .nav-link {
            text-decoration: none;
            color: #2a2a2a;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 8px;
            transition: background-color 0.2s;
        }

        .nav-link:hover {
            background-color: #f3f4f6;
        }

        .sign-in-btn {
            background: #006ba6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .sign-in-btn:hover {
            background: #005691;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            padding: 80px 20px 120px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><polygon fill="%23ffffff05" points="0,1000 1000,0 1000,1000"/></svg>');
            background-size: cover;
        }

        .hero-content {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .hero-title {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 16px;
            line-height: 1.1;
        }

        .hero-tagline {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 12px;
            opacity: 0.95;
            color: #ffd700;
        }

        .hero-subtitle {
            font-size: 20px;
            margin-bottom: 48px;
            opacity: 0.9;
            font-weight: 400;
        }

        /* Search Container */
        .search-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            padding: 24px;
            margin-bottom: 32px;
        }

        /* Search Tabs */
        .search-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            background: #f3f4f6;
            padding: 4px;
            border-radius: 12px;
        }

        .tab-btn {
            flex: 1;
            background: transparent;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 600;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .tab-btn.active {
            background: white;
            color: #1f2937;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        /* AI Search Bar */
        .ai-search-bar {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            display: flex;
            align-items: center;
            margin-bottom: 16px;
            transition: border-color 0.2s;
        }

        .ai-search-bar:focus-within {
            border-color: #3b82f6;
        }

        .search-icon {
            color: #6b7280;
            margin: 0 16px;
            font-size: 20px;
        }

        .ai-search-bar input {
            flex: 1;
            border: none;
            background: transparent;
            padding: 20px 0;
            font-size: 16px;
            outline: none;
            color: #1f2937;
        }

        .ai-search-bar input::placeholder {
            color: #9ca3af;
        }

        .search-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 16px 32px;
            margin: 8px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s;
        }

        .search-btn:hover {
            background: #2563eb;
        }

        .ai-help-text {
            text-align: center;
            color: #6b7280;
            font-size: 14px;
        }

        /* Customize Search Styles */
        .filtration-step {
            display: none;
        }

        .filtration-step.active {
            display: block;
        }

        .step-title {
            text-align: center;
            color: #1f2937;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .step-title i {
            color: #3b82f6;
        }

        .selected-category-display {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .selected-category-label {
            color: #1e40af;
            font-weight: 600;
            font-size: 14px;
        }

        .selected-category-value {
            background: #3b82f6;
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }

        .change-category-btn {
            background: #f3f4f6;
            color: #374151;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            transition: all 0.2s;
            margin-left: auto;
        }

        .change-category-btn:hover {
            background: #e5e7eb;
            transform: translateY(-1px);
        }

        .change-category-btn i {
            font-size: 10px;
        }

        /* Tab Content */
        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        .zipcode-search {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .zipcode-input {
            flex: 1;
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.2s;
        }

        .zipcode-input:focus {
            border-color: #3b82f6;
        }

        /* Category Grid */
        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
        }

        .category-btn, .affiliation-btn {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            padding: 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            font-weight: 600;
            color: #374151;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .category-btn:hover, .affiliation-btn:hover {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        .category-btn i, .affiliation-btn i {
            font-size: 24px;
            color: #3b82f6;
            transition: color 0.2s;
        }

        .category-btn:hover i, .affiliation-btn:hover i {
            color: white;
        }

        /* Affiliation Grid */
        .affiliation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px;
        }

        /* Quick Stats */
        .quick-stats {
            background: white;
            padding: 60px 20px;
        }

        .stats-container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            text-align: center;
        }

        .stat-item {
            padding: 20px;
        }

        .stat-number {
            font-size: 48px;
            font-weight: 700;
            color: #3b82f6;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 16px;
            color: #6b7280;
            font-weight: 500;
        }
    </style>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Leaflet CSS for real maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>

    <style>
        /* Authentication Modal Styles */
        /* Responsive Design */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 36px;
            }

            .hero-subtitle {
                font-size: 18px;
            }

            .search-tabs {
                flex-direction: column;
                gap: 4px;
            }

            .tab-btn {
                padding: 16px;
            }

            .ai-search-bar {
                flex-direction: column;
                gap: 16px;
                padding: 16px;
            }

            .search-btn {
                width: 100%;
                justify-content: center;
                margin: 0;
            }

            .category-grid, .affiliation-grid {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            }

            .recommendations-grid, .results-grid {
                grid-template-columns: 1fr;
            }

            .nav-links {
                display: none;
            }

            /* Results layout responsive */
            .results-layout {
                flex-direction: column;
                height: auto;
            }

            .map-container {
                height: 300px;
                border-right: none;
                border-bottom: 1px solid #d1d5db;
            }

            .results-panel {
                max-height: none;
            }

            .results-controls {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
            }

            .filter-checkboxes {
                flex-direction: column;
                gap: 8px;
            }

            .stats-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }

            .stat-number {
                font-size: 36px;
            }
        }

        /* Authentication Modal Styles */
        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 20px;
        }

        .auth-modal-content {
            background: white;
            border-radius: 16px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .auth-close {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            color: #9ca3af;
            cursor: pointer;
            line-height: 1;
            z-index: 1;
        }

        .auth-close:hover {
            color: #374151;
        }

        .auth-form {
            padding: 40px;
        }

        .auth-form h2 {
            font-size: 28px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 8px;
            text-align: center;
        }

        .auth-subtitle {
            color: #6b7280;
            text-align: center;
            margin-bottom: 32px;
            font-size: 16px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin: 0;
        }

        .checkbox-item label {
            margin: 0;
            font-weight: 500;
            cursor: pointer;
        }

        .auth-btn {
            width: 100%;
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 8px;
        }

        .auth-btn.primary {
            background: #3b82f6;
            color: white;
        }

        .auth-btn.primary:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        .auth-switch {
            text-align: center;
            margin-top: 24px;
            color: #6b7280;
        }

        .auth-switch a {
            color: #3b82f6;
            text-decoration: none;
            font-weight: 600;
        }

        .auth-switch a:hover {
            text-decoration: underline;
        }

        /* Responsive auth modal */
        @media (max-width: 768px) {
            .auth-modal-content {
                margin: 20px;
                max-width: none;
            }

            .auth-form {
                padding: 30px 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 0;
            }

            .auth-form h2 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="nav-container">
            <a href="#" class="logo" onclick="returnToHome()">ðŸ•Ž Jewish Mapped</a>
            <nav class="nav-links">
                <a href="#" class="nav-link">Find</a>
                <a href="#" class="nav-link">Community</a>
                <a href="#" class="nav-link">Resources</a>
                <a href="#" class="nav-link">About</a>
                <a href="#" class="nav-link" id="myProfileLink" onclick="showProfilePage()" style="display: none;">My Profile</a>
                <button class="sign-in-btn" onclick="openAuthModal()">Sign in</button>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <h1 class="hero-title">Your home for all things Jewish</h1>
            <p class="hero-tagline">Jewish Connections Made Easy for You</p>
            <p class="hero-subtitle">Connecting communities, celebrating tradition, building the future</p>
            
            <div class="search-container">
                <!-- Search Tabs -->
                <div class="search-tabs">
                    <button class="tab-btn active" data-tab="ai">
                        <i class="fas fa-robot"></i>
                        Ask AI
                    </button>
                    <button class="tab-btn" data-tab="filtration">
                        <i class="fas fa-filter"></i>
                        Customize Search
                    </button>
                </div>

                <!-- Tab Content -->
                <div class="tab-content">
                    <!-- Ask AI -->
                    <div class="tab-pane active" id="ai-tab">
                        <div class="ai-search-bar">
                            <i class="fas fa-robot search-icon"></i>
                            <input type="text" id="aiSearchInput" placeholder="Try: 'Orthodox synagogue with youth programs' or 'Reform temple in Manhattan'">
                            <button class="search-btn" id="aiSearchBtn">
                                <i class="fas fa-search"></i>
                                Search
                            </button>
                        </div>
                        <p class="ai-help-text">
                            <i class="fas fa-lightbulb"></i>
                            Describe what you're looking for in plain English
                        </p>
                    </div>

                    <!-- Customize Search -->
                    <div class="tab-pane" id="filtration-tab">
                        <!-- Step 1: Category Selection -->
                        <div class="filtration-step active" id="category-step">
                            <h3 class="step-title">
                                <i class="fas fa-list"></i>
                                Step 1: Choose a Category
                            </h3>
                            <div class="category-grid">
                                <button class="category-btn" onclick="selectCategory('synagogue')">
                                    <i class="fas fa-synagogue"></i>
                                    Synagogues
                                </button>
                                <button class="category-btn" onclick="selectCategory('school')">
                                    <i class="fas fa-school"></i>
                                    Schools
                                </button>
                                <button class="category-btn" onclick="selectCategory('youth')">
                                    <i class="fas fa-users"></i>
                                    Youth Programs
                                </button>
                                <button class="category-btn" onclick="selectCategory('education')">
                                    <i class="fas fa-book"></i>
                                    Education
                                </button>
                                <button class="category-btn" onclick="selectCategory('hillel')">
                                    <i class="fas fa-university"></i>
                                    Campus Hillel
                                </button>
                                <button class="category-btn" onclick="selectCategory('community')">
                                    <i class="fas fa-heart"></i>
                                    Community
                                </button>
                            </div>
                        </div>

                        <!-- Step 2: Zip Code Entry -->
                        <div class="filtration-step" id="zipcode-step" style="display: none;">
                            <h3 class="step-title">
                                <i class="fas fa-map-marker-alt"></i>
                                Step 2: Enter Your Zip Code
                            </h3>
                            <div class="selected-category-display">
                                <span class="selected-category-label">Selected Category:</span>
                                <span class="selected-category-value" id="selectedCategoryDisplay"></span>
                                <button class="change-category-btn" onclick="goBackToCategory()">
                                    <i class="fas fa-edit"></i>
                                    Change
                                </button>
                            </div>
                            <div class="zipcode-search">
                                <input type="text" id="filtrationZipcodeInput" class="zipcode-input" placeholder="Enter zip code (e.g., 10001)">
                                <button class="search-btn" onclick="searchByFiltration()">
                                    <i class="fas fa-search"></i>
                                    Search
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Profile Page Section -->
    <section class="profile-page" id="profilePage" style="display: none;">
        <div class="container">
            <div class="profile-header">
                <h2 class="section-title">
                    <i class="fas fa-user-circle"></i>
                    My Profile
                </h2>
                <button class="back-btn" onclick="hideProfilePage()">
                    <i class="fas fa-arrow-left"></i>
                    Back to Search
                </button>
            </div>
            
            <div class="profile-content">
                <!-- Basic Info Section -->
                <div class="profile-section">
                    <div class="profile-info-card">
                        <h3><i class="fas fa-info-circle"></i> Basic Information</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <label>Name:</label>
                                <span id="profileName">-</span>
                            </div>
                            <div class="info-item">
                                <label>Email:</label>
                                <span id="profileEmail">-</span>
                            </div>
                            <div class="info-item">
                                <label>Address:</label>
                                <span id="profileAddress">-</span>
                            </div>
                            <div class="info-item">
                                <label>Jewish Affiliation:</label>
                                <span id="profileAffiliation">-</span>
                            </div>
                            <div class="info-item">
                                <label>Interests:</label>
                                <span id="profileInterests">-</span>
                            </div>
                            <div class="info-item">
                                <label>Member Since:</label>
                                <span id="profileMemberSince">-</span>
                            </div>
                        </div>
                        <button class="edit-profile-btn" onclick="editProfile()">
                            <i class="fas fa-edit"></i>
                            Edit Profile
                        </button>
                    </div>
                </div>

                <!-- Connections Section -->
                <div class="profile-section">
                    <div class="connections-card">
                        <h3><i class="fas fa-link"></i> My Connections</h3>
                        <p class="connections-subtitle">Jewish programs and institutions you've connected with</p>
                        
                        <div class="connections-stats">
                            <div class="stat-box">
                                <span class="stat-number" id="totalConnections">0</span>
                                <span class="stat-label">Total Connections</span>
                            </div>
                            <div class="stat-box">
                                <span class="stat-number" id="recentConnections">0</span>
                                <span class="stat-label">This Month</span>
                            </div>
                        </div>

                        <div class="connections-filter">
                            <button class="filter-btn active" onclick="filterConnections('all')">All</button>
                            <button class="filter-btn" onclick="filterConnections('synagogue')">Synagogues</button>
                            <button class="filter-btn" onclick="filterConnections('school')">Schools</button>
                            <button class="filter-btn" onclick="filterConnections('youth')">Youth Programs</button>
                            <button class="filter-btn" onclick="filterConnections('community')">Community</button>
                        </div>

                        <div class="connections-list" id="connectionsList">
                            <div class="no-connections">
                                <i class="fas fa-heart"></i>
                                <h4>No connections yet</h4>
                                <p>Start exploring Jewish institutions and programs to build your community network!</p>
                                <button class="explore-btn" onclick="hideProfilePage()">
                                    <i class="fas fa-search"></i>
                                    Explore Now
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <!-- Search Results Section -->
    <section class="search-results" id="searchResults" style="display: none;">
        <div class="results-container">
            <!-- Results Header -->
            <div class="results-header">
                <h2 class="results-title" id="resultsTitle">Search Results</h2>
                <div class="results-count" id="resultsCount"></div>
            </div>
            
            <!-- Main Results Layout -->
            <div class="results-layout">
                <!-- Map Container -->
                <div class="map-container">
                    <div id="map" class="map-view" style="min-height: 400px; background: #f0f0f0;">
                        <!-- Interactive map will be initialized here -->
                        <div id="loading-message" style="display: flex; align-items: center; justify-content: center; height: 100%; flex-direction: column; color: #6b7280;">
                            <i class="fas fa-spinner fa-spin" style="font-size: 24px; margin-bottom: 12px;"></i>
                            <p>Loading interactive map...</p>
                        </div>
                    </div>
                    
                    <!-- Map Controls -->
                    <div class="map-controls">
                        <button class="map-control-btn" id="zoomIn" title="Zoom In">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="map-control-btn" id="zoomOut" title="Zoom Out">
                            <i class="fas fa-minus"></i>
                        </button>
                        <button class="map-control-btn" id="centerMap" title="Center Map">
                            <i class="fas fa-crosshairs"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Results Panel -->
                <div class="results-panel">
                    <!-- Sort and Filter Controls -->
                    <div class="results-controls">
                        <div class="sort-controls">
                            <label for="sortSelect">Sort by:</label>
                            <select id="sortSelect" class="sort-select">
                                <option value="relevance">Most Relevant</option>
                                <option value="distance">Distance</option>
                                <option value="name">Name A-Z</option>
                                <option value="denomination">Denomination</option>
                            </select>
                        </div>
                        
                        <div class="filter-controls">
                            <button class="filter-btn" id="filterToggle">
                                <i class="fas fa-filter"></i>
                                Filters
                            </button>
                        </div>
                    </div>
                    
                    <!-- Filter Panel (collapsible) -->
                    <div class="filter-panel" id="filterPanel" style="display: none;">
                        <div class="filter-section">
                            <h4>Denomination</h4>
                            <div class="filter-checkboxes">
                                <label><input type="checkbox" value="reform"> Reform</label>
                                <label><input type="checkbox" value="conservative"> Conservative</label>
                                <label><input type="checkbox" value="orthodox"> Orthodox</label>
                                <label><input type="checkbox" value="chabad"> Chabad</label>
                                <label><input type="checkbox" value="reconstructionist"> Reconstructionist</label>
                            </div>
                        </div>
                        
                        <div class="filter-section">
                            <h4>Programs</h4>
                            <div class="filter-checkboxes">
                                <label><input type="checkbox" value="youth"> Youth Programs</label>
                                <label><input type="checkbox" value="hebrew"> Hebrew School</label>
                                <label><input type="checkbox" value="adult"> Adult Education</label>
                                <label><input type="checkbox" value="family"> Family Programs</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Results List -->
                    <div class="results-list" id="resultsGrid">
                        <!-- Results will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>ðŸ•Ž Jewish Mapped</h3>
                    <p>Connecting Jewish communities across America</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
                <div class="footer-section">
                    <h4>Find</h4>
                    <a href="#">Synagogues</a>
                    <a href="#">Jewish Schools</a>
                    <a href="#">Youth Programs</a>
                    <a href="#">Campus Hillel</a>
                </div>
                <div class="footer-section">
                    <h4>Resources</h4>
                    <a href="#">Community Directory</a>
                    <a href="#">Event Calendar</a>
                    <a href="#">Educational Programs</a>
                    <a href="#">Support Services</a>
                </div>
                <div class="footer-section">
                    <h4>Support</h4>
                    <a href="#">Help Center</a>
                    <a href="#">Contact Us</a>
                    <a href="#">Privacy Policy</a>
                    <a href="#">Terms of Service</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Jewish Mapped. All rights reserved. | Connecting communities nationwide.</p>
            </div>
        </div>
    </footer>

    <!-- Loading Spinner -->
    <div class="loading-spinner" id="loadingSpinner" style="display: none;">
        <div class="spinner"></div>
        <p>Searching our database...</p>
    </div>

    <style>
        /* Additional styles for sections and components */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Recommendations Section */
        .recommendations {
            background: #f8fafc;
            padding: 80px 20px;
        }

        .section-title {
            text-align: center;
            font-size: 32px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 48px;
        }

        .section-title i {
            color: #fbbf24;
            margin-right: 12px;
        }

        .recommendations-grid, .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 24px;
        }

        /* Search Results - Zillow-like Layout */
        .search-results {
            background: #f7f8fa;
            padding: 0;
            min-height: calc(100vh - 80px);
        }

        .results-container {
            max-width: 100%;
            margin: 0;
            padding: 0;
        }

        .results-header {
            background: white;
            padding: 20px 24px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .results-title {
            font-size: 24px;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
        }

        .results-count {
            color: #6b7280;
            font-size: 14px;
        }

        .results-layout {
            display: flex;
            height: calc(100vh - 140px);
        }

        /* Map Container */
        .map-container {
            flex: 1;
            position: relative;
            background: #e5e7eb;
            border-right: 1px solid #d1d5db;
        }

        .map-view {
            width: 100%;
            height: 100%;
            position: relative;
            min-height: 400px;
            background: #f0f0f0; /* Visible background to debug */
        }
        
        /* Ensure Leaflet map is properly sized and visible */
        .leaflet-container {
            height: 100% !important;
            width: 100% !important;
            background: #a8d8ea !important; /* Blue background to see map area */
            position: relative !important;
            z-index: 1;
        }
        
        /* Ensure map tiles are visible */
        .leaflet-tile {
            opacity: 1 !important;
        }

        .map-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            color: #6b7280;
            text-align: center;
        }

        .map-placeholder i {
            font-size: 48px;
            margin-bottom: 16px;
            color: #9ca3af;
        }

        .map-placeholder p {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #374151;
        }

        .map-placeholder small {
            font-size: 14px;
            color: #6b7280;
        }

        .map-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .map-control-btn {
            width: 40px;
            height: 40px;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .map-control-btn:hover {
            background: #f9fafb;
            border-color: #9ca3af;
        }

        .map-control-btn i {
            color: #374151;
            font-size: 14px;
        }

        /* Results Panel */
        .results-panel {
            flex: 1;
            background: white;
            display: flex;
            flex-direction: column;
            max-height: calc(100vh - 140px);
        }

        .results-controls {
            padding: 16px 20px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
        }

        .sort-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sort-controls label {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
        }

        .sort-select {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            color: #374151;
            outline: none;
        }

        .sort-select:focus {
            border-color: #3b82f6;
            ring: 2px;
            ring-color: rgba(59, 130, 246, 0.1);
        }

        .filter-controls .filter-btn {
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }

        .filter-controls .filter-btn:hover {
            background: #e5e7eb;
        }

        .filter-controls .filter-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        /* Filter Panel */
        .filter-panel {
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
            padding: 16px 20px;
        }

        .filter-section {
            margin-bottom: 16px;
        }

        .filter-section:last-child {
            margin-bottom: 0;
        }

        .filter-section h4 {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .filter-checkboxes {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
        }

        .filter-checkboxes label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            color: #374151;
            cursor: pointer;
        }

        .filter-checkboxes input[type="checkbox"] {
            width: 16px;
            height: 16px;
            border: 1px solid #d1d5db;
            border-radius: 3px;
            accent-color: #3b82f6;
        }

        /* Results List */
        .results-list {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f7f8fa;
        }

        /* Institution Cards - Updated for List Layout */
        .institution-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 1px solid #e5e7eb;
            margin-bottom: 16px;
        }

        .institution-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-color: #3b82f6;
        }

        /* Demo Map Styles */
        .demo-map {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            background: #f8fafc;
        }

        .demo-map-header {
            background: white;
            padding: 16px 20px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .demo-map-header h3 {
            font-size: 18px;
            font-weight: 600;
            color: #374151;
            margin: 0;
        }

        .demo-map-count {
            font-size: 14px;
            color: #6b7280;
            background: #f3f4f6;
            padding: 4px 12px;
            border-radius: 12px;
        }

        .demo-map-content {
            flex: 1;
            position: relative;
            background: linear-gradient(135deg, #e0f2fe 0%, #b3e5fc 100%);
        }

        .demo-map-area {
            width: 100%;
            height: calc(100% - 60px);
            position: relative;
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(16, 185, 129, 0.1) 0%, transparent 50%);
        }

        .demo-marker {
            position: absolute !important;
            z-index: 10 !important;
            cursor: pointer;
            transition: transform 0.2s ease;
            width: 40px;
            height: 50px;
        }

        .demo-marker:hover {
            transform: scale(1.2);
            z-index: 100;
        }

        .demo-marker:hover .marker-icon {
            background: #1d4ed8;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.5);
        }

        .marker-icon {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #2563eb;
            color: white;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            position: relative;
        }

        .marker-icon i {
            font-size: 14px;
            color: white;
        }



        .marker-tooltip {
            position: absolute;
            bottom: 35px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 8px 12px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 1px solid #e5e7eb;
            white-space: nowrap;
            display: none;
            z-index: 20;
            max-width: 200px;
            text-align: center;
        }

        .marker-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: white;
        }

        .marker-tooltip strong {
            color: #374151;
            font-size: 14px;
            display: block;
            margin-bottom: 2px;
        }

        .marker-tooltip small {
            color: #6b7280;
            font-size: 12px;
        }

        .demo-map-legend {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            padding: 12px 20px;
            border-top: 1px solid rgba(229, 231, 235, 0.8);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }

        .legend-item i {
            color: #3b82f6;
            font-size: 14px;
        }

        .legend-item span {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
        }

        .legend-note {
            margin-top: 4px;
        }

        .legend-note small {
            color: #6b7280;
            font-size: 12px;
        }

        /* Leaflet Map Styles */
        .leaflet-marker-icon {
            background: #2563eb;
            color: white;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 30px !important;
            height: 30px !important;
        }

        .leaflet-marker-icon i {
            font-size: 14px;
            color: white;
        }

        .marker-popup h4 {
            margin: 0 0 8px 0;
            color: #1f2937;
            font-size: 16px;
        }

        .marker-popup p {
            margin: 4px 0;
            font-size: 14px;
        }

        .marker-popup small {
            color: #6b7280;
            font-size: 12px;
        }

        .map-error {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            color: #6b7280;
            padding: 2rem;
        }

        .map-error i {
            font-size: 48px;
            color: #f59e0b;
            margin-bottom: 16px;
        }

        .map-error h3 {
            color: #374151;
            margin-bottom: 8px;
        }

        /* Override Leaflet default styles */
        .custom-marker {
            background: transparent !important;
            border: none !important;
        }

        /* Loading spinner animation */
        .fa-spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .card-header {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 24px;
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
            line-height: 1.2;
        }

        .card-denomination {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .card-body {
            padding: 24px;
        }

        .card-address, .card-phone {
            color: #6b7280;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .card-address i, .card-phone i {
            color: #3b82f6;
            width: 16px;
        }

        .card-programs {
            margin-top: 16px;
        }

        .card-programs strong {
            color: #374151;
            font-size: 14px;
            display: block;
            margin-bottom: 8px;
        }

        .program-tag {
            background: #dbeafe;
            color: #1e40af;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 500;
            margin: 4px 8px 4px 0;
            display: inline-block;
        }

        .card-website {
            margin-top: 20px;
            text-align: center;
        }

        .website-btn {
            background: #3b82f6;
            color: white;
            text-decoration: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: background-color 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .website-btn:hover {
            background: #2563eb;
        }

        .card-actions {
            margin-top: 16px;
            text-align: center;
        }

        .connect-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            font-size: 14px;
        }

        .connect-btn:hover {
            background: #059669;
            transform: translateY(-1px);
        }

        .connect-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        /* Footer */
        .footer {
            background: #1f2937;
            color: white;
            padding: 60px 20px 20px;
        }

        .footer-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        }

        .footer-section h3 {
            font-size: 20px;
            margin-bottom: 16px;
            color: #3b82f6;
        }

        .footer-section h4 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #f3f4f6;
        }

        .footer-section p {
            color: #9ca3af;
            margin-bottom: 16px;
            line-height: 1.6;
        }

        .footer-section a {
            color: #d1d5db;
            text-decoration: none;
            display: block;
            margin-bottom: 8px;
            transition: color 0.2s;
            font-size: 14px;
        }

        .footer-section a:hover {
            color: #3b82f6;
        }

        .social-links {
            display: flex;
            gap: 16px;
            margin-top: 16px;
        }

        .social-links a {
            background: #374151;
            color: #d1d5db;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .social-links a:hover {
            background: #3b82f6;
            color: white;
        }

        .footer-bottom {
            border-top: 1px solid #374151;
            padding-top: 20px;
            text-align: center;
            color: #9ca3af;
            font-size: 14px;
        }

        /* Loading Spinner */
        .loading-spinner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #3b82f6;
            width: 48px;
            height: 48px;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-spinner p {
            font-size: 16px;
            font-weight: 500;
        }

        /* Profile Page Styles */
        .profile-page {
            background: white;
            padding: 80px 20px;
            min-height: 100vh;
        }

        .profile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }

        .back-btn {
            background: #f3f4f6;
            color: #374151;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .back-btn:hover {
            background: #e5e7eb;
            transform: translateX(-2px);
        }

        .profile-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .profile-section {
            height: fit-content;
        }

        .profile-info-card, .connections-card {
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border: 1px solid #e5e7eb;
        }

        .profile-info-card h3, .connections-card h3 {
            font-size: 20px;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .profile-info-card h3 i, .connections-card h3 i {
            color: #3b82f6;
        }

        .info-grid {
            display: grid;
            gap: 20px;
            margin-bottom: 24px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid #f3f4f6;
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-item label {
            font-weight: 600;
            color: #6b7280;
            flex: 0 0 140px;
        }

        .info-item span {
            color: #1f2937;
            font-weight: 500;
            text-align: right;
            flex: 1;
        }

        .edit-profile-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            width: 100%;
            justify-content: center;
        }

        .edit-profile-btn:hover {
            background: #2563eb;
        }

        .connections-subtitle {
            color: #6b7280;
            margin-bottom: 24px;
            font-size: 16px;
        }

        .connections-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-box {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            flex: 1;
        }

        .stat-number {
            display: block;
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .connections-filter {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            background: #f3f4f6;
            padding: 4px;
            border-radius: 12px;
            flex-wrap: wrap;
        }

        .filter-btn {
            background: transparent;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            font-weight: 600;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.2s;
            flex: 1;
            min-width: 80px;
        }

        .filter-btn.active {
            background: white;
            color: #1f2937;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .filter-btn:hover:not(.active) {
            background: rgba(255, 255, 255, 0.5);
        }

        .connections-list {
            min-height: 200px;
        }

        .no-connections {
            text-align: center;
            padding: 40px 20px;
            color: #6b7280;
        }

        .no-connections i {
            font-size: 48px;
            color: #d1d5db;
            margin-bottom: 16px;
        }

        .no-connections h4 {
            font-size: 20px;
            color: #374151;
            margin-bottom: 8px;
        }

        .no-connections p {
            margin-bottom: 24px;
            line-height: 1.6;
        }

        .explore-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .explore-btn:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }

        .connection-item {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.2s;
        }

        .connection-item:hover {
            background: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .connection-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .connection-name {
            font-weight: 700;
            color: #1f2937;
            font-size: 16px;
            margin-bottom: 4px;
        }

        .connection-type {
            background: #dbeafe;
            color: #1e40af;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .connection-date {
            color: #6b7280;
            font-size: 12px;
            text-align: right;
        }

        .connection-address {
            color: #6b7280;
            font-size: 14px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .connection-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .connection-btn {
            background: #f3f4f6;
            color: #374151;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .connection-btn:hover {
            background: #e5e7eb;
        }

        .connection-btn.primary {
            background: #3b82f6;
            color: white;
        }

        .connection-btn.primary:hover {
            background: #2563eb;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 36px;
            }

            .hero-subtitle {
                font-size: 18px;
            }

            .search-tabs {
                flex-direction: column;
                gap: 4px;
            }

            .tab-btn {
                padding: 16px;
            }

            .ai-search-bar {
                flex-direction: column;
                gap: 16px;
                padding: 16px;
            }

            .search-btn {
                width: 100%;
                justify-content: center;
                margin: 0;
            }

            .category-grid, .affiliation-grid {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            }

            .recommendations-grid, .results-grid {
                grid-template-columns: 1fr;
            }

            .nav-links {
                display: none;
            }

            .stats-container {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }

            .stat-number {
                font-size: 36px;
            }

            /* Profile page responsive */
            .profile-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .profile-header {
                flex-direction: column;
                gap: 16px;
                text-align: center;
            }

            .profile-info-card, .connections-card {
                padding: 20px;
            }

            .info-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
                text-align: left;
            }

            .info-item span {
                text-align: left;
            }

            .connections-stats {
                flex-direction: column;
                gap: 12px;
            }

            .connections-filter {
                flex-wrap: wrap;
                gap: 4px;
            }

            .filter-btn {
                flex: 1 1 auto;
                min-width: 100px;
            }
            
            /* Customize search responsive */
            .selected-category-display {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .change-category-btn {
                margin-left: 0;
                align-self: flex-end;
            }
            
            .step-title {
                font-size: 18px;
                margin-bottom: 20px;
            }
        }
    </style>

    <!-- Authentication Modal -->
    <div id="authModal" class="auth-modal" style="display: none;">
        <div class="auth-modal-content">
            <span class="auth-close" onclick="closeAuthModal()">&times;</span>
            
            <!-- Login Form -->
            <div id="loginForm" class="auth-form">
                <h2>Welcome Back</h2>
                <p class="auth-subtitle">Sign in to your Jewish Mapped account</p>
                
                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    
                    <button type="submit" class="auth-btn primary">Sign In</button>
                </form>
                
                <p class="auth-switch">
                    Don't have an account? 
                    <a href="#" onclick="showSignupForm()">Create an account</a>
                </p>
            </div>
            
            <!-- Signup Form -->
            <div id="signupForm" class="auth-form" style="display: none;">
                <h2>Join Jewish Mapped</h2>
                <p class="auth-subtitle">Create your account to connect with Jewish communities</p>
                
                <form onsubmit="handleSignup(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="firstName">First Name *</label>
                            <input type="text" id="firstName" required>
                        </div>
                        <div class="form-group">
                            <label for="lastName">Last Name *</label>
                            <input type="text" id="lastName" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="signupEmail">Email Address *</label>
                        <input type="email" id="signupEmail" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="signupPassword">Password *</label>
                        <input type="password" id="signupPassword" required minlength="6">
                    </div>
                    
                    <div class="form-group">
                        <label for="address1">Address 1 *</label>
                        <input type="text" id="address1" required placeholder="Street address">
                    </div>
                    
                    <div class="form-group">
                        <label for="address2">Address 2</label>
                        <input type="text" id="address2" placeholder="Apartment, suite, unit, etc. (optional)">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="city">City *</label>
                            <input type="text" id="city" required placeholder="City">
                        </div>
                        <div class="form-group">
                            <label for="state">State *</label>
                            <input type="text" id="state" required placeholder="State">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="zipCode">Zip Code *</label>
                        <input type="text" id="zipCode" required placeholder="12345" pattern="[0-9]{5}(-[0-9]{4})?" title="Please enter a valid ZIP code (e.g., 12345 or 12345-6789)">
                    </div>
                    
                    <div class="form-group">
                        <label for="jewishAffiliation">Jewish Affiliation *</label>
                        <select id="jewishAffiliation" required>
                            <option value="">Select your affiliation</option>
                            <option value="reform">Reform</option>
                            <option value="conservative">Conservative</option>
                            <option value="orthodox">Orthodox</option>
                            <option value="reconstructionist">Reconstructionist</option>
                            <option value="chabad">Chabad</option>
                            <option value="pluralistic">Pluralistic</option>
                            <option value="secular">Secular/Cultural</option>
                            <option value="other">Other</option>
                            <option value="prefer-not-to-say">Prefer not to say</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>What are you interested in? *</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="findingCommunity" name="interests" value="finding-community">
                                <label for="findingCommunity">Finding community</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="jewishVendors" name="interests" value="jewish-vendors">
                                <label for="jewishVendors">Jewish vendors</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="mitzvahProjects" name="interests" value="mitzvah-projects">
                                <label for="mitzvahProjects">Mitzvah project opportunities</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="collegeEngagement" name="interests" value="college-engagement">
                                <label for="collegeEngagement">Jewish engagement on college campus</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="otherInterest" name="interests" value="other">
                                <label for="otherInterest">Other</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group" id="otherInterestGroup" style="display: none;">
                        <label for="otherInterestDetails">Please describe your other interests</label>
                        <textarea id="otherInterestDetails" rows="3" placeholder="Tell us what specific interests you have..."></textarea>
                    </div>
                    
                    <button type="submit" class="auth-btn primary">Create Account</button>
                </form>
                
                <p class="auth-switch">
                    Already have an account? 
                    <a href="#" onclick="showLoginForm()">Sign in</a>
                </p>
            </div>
        </div>
    </div>
    <script src="script.js"></script>
    
    <!-- Leaflet JavaScript for real maps -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    
    <!-- Google Maps API -->
    <script>
        // Google Maps API key - Replace with your actual API key
        const GOOGLE_MAPS_API_KEY = 'YOUR_API_KEY_HERE';
        
        // Load Google Maps API dynamically
        function loadGoogleMapsAPI() {
            if (typeof google !== 'undefined' && google.maps) {
                return Promise.resolve();
            }
            
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = `https://maps.googleapis.com/maps/api/js?key=${GOOGLE_MAPS_API_KEY}&libraries=places`;
                script.async = true;
                script.defer = true;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }
        
        // Simple, guaranteed-to-work map initialization
        window.initializeMapForResults = function(institutions) {
            console.log('ðŸ”„ Starting SIMPLE map initialization...');
            
            const safeInstitutions = Array.isArray(institutions) ? institutions : [];
            console.log('ðŸ“Š Institutions to map:', safeInstitutions.length);
            
            // ALWAYS show something - no complex promises or async
            showSimpleMap(safeInstitutions);
        };
        
        // Simple map that ALWAYS works
        function showSimpleMap(institutions) {
            const mapContainer = document.getElementById('map');
            if (!mapContainer) {
                console.error('âŒ Map container not found');
                return;
            }
            
            // Create a visual map representation that always works
            const institutionList = institutions.slice(0, 10).map((inst, index) => {
                const position = getDisplayPosition(index, institutions.length);
                return `
                    <div class="simple-marker" 
                         style="position: absolute; 
                                left: ${position.x}%; 
                                top: ${position.y}%; 
                                transform: translate(-50%, -50%);
                                z-index: 10;">
                        <div class="marker-pin" 
                             style="width: 20px; 
                                    height: 20px; 
                                    background: #3b82f6; 
                                    border-radius: 50%; 
                                    border: 3px solid white; 
                                    box-shadow: 0 2px 8px rgba(0,0,0,0.3); 
                                    cursor: pointer;"
                             title="${inst['Synagogue Name'] || 'Institution'} - ${inst['Full Address'] || 'Address not available'}">
                        </div>
                    </div>
                `;
            }).join('');
            
            mapContainer.innerHTML = `
                <div style="height: 100%; 
                           background: linear-gradient(135deg, #a8d8ea 0%, #7fb8c4 100%); 
                           position: relative; 
                           border-radius: 8px; 
                           overflow: hidden;">
                    
                    <!-- Map Header -->
                    <div style="position: absolute; 
                               top: 15px; 
                               left: 15px; 
                               background: rgba(255,255,255,0.9); 
                               padding: 8px 12px; 
                               border-radius: 6px; 
                               box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                               z-index: 20;">
                        <strong style="color: #1f2937; font-size: 14px;">
                            ðŸ“ ${institutions.length} Institution${institutions.length !== 1 ? 's' : ''} Found
                        </strong>
                    </div>
                    
                    <!-- Map Content -->
                    <div style="position: relative; height: 100%; width: 100%;">
                        ${institutionList}
                    </div>
                    
                    <!-- Map Legend -->
                    <div style="position: absolute; 
                               bottom: 15px; 
                               left: 15px; 
                               background: rgba(255,255,255,0.9); 
                               padding: 8px 12px; 
                               border-radius: 6px; 
                               box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                               z-index: 20;">
                        <small style="color: #6b7280;">
                            ðŸ—ºï¸ Visual Map View - Hover pins for details
                        </small>
                    </div>
                </div>
            `;
            
            console.log('âœ… Simple map displayed with', institutions.length, 'markers');
        }
        
        // Calculate display positions for markers
        function getDisplayPosition(index, total) {
            // Create a nice spread pattern
            const patterns = [
                // For 1-4 institutions
                [{x: 50, y: 50}],
                [{x: 35, y: 40}, {x: 65, y: 60}],
                [{x: 30, y: 35}, {x: 50, y: 60}, {x: 70, y: 45}],
                [{x: 25, y: 30}, {x: 45, y: 55}, {x: 65, y: 35}, {x: 75, y: 65}],
                // For 5+ institutions - grid pattern
            ];
            
            if (total <= 4 && patterns[total - 1]) {
                return patterns[total - 1][index] || {x: 50, y: 50};
            }
            
            // Grid pattern for 5+ institutions
            const cols = Math.ceil(Math.sqrt(total));
            const rows = Math.ceil(total / cols);
            const col = index % cols;
            const row = Math.floor(index / cols);
            
            return {
                x: 20 + (col * 60 / (cols - 1 || 1)),
                y: 25 + (row * 50 / (rows - 1 || 1))
            };
        }
        
                // Real map implementation using Leaflet
        let mapInstance = null;
        let mapMarkers = [];
        
        async function initializeDemoMap(institutions) {
            console.log('ðŸ—ºï¸ STARTING MAP INITIALIZATION');
            console.log('ðŸ“ Input institutions:', {
                count: institutions ? institutions.length : 0,
                sample: institutions ? institutions.slice(0, 2) : [],
                addresses: institutions ? institutions.map(i => i['Full Address']).slice(0, 3) : []
            });
            
            const mapContainer = document.getElementById('map');
            const mapPlaceholder = document.getElementById('mapPlaceholder');
            
            console.log('ðŸ” Map elements:', {
                mapContainer: !!mapContainer,
                mapPlaceholder: !!mapPlaceholder,
                mapContainerVisible: mapContainer ? mapContainer.style.display !== 'none' : false
            });
            
            // Show loading state
            if (mapPlaceholder) {
                mapPlaceholder.innerHTML = `
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Loading Map & Geocoding Addresses...</p>
                    <small>Getting precise locations for institutions</small>
                `;
                mapPlaceholder.style.display = 'flex';
            }
            
            // Clear any existing content
            mapContainer.innerHTML = '';
            
                        // Initialize the map if not already done
            if (!mapInstance) {
                try {
                    // Ensure container is ready and properly sized
                    mapContainer.innerHTML = '';
                    mapContainer.style.height = '100%';
                    mapContainer.style.width = '100%';
                    mapContainer.style.position = 'relative';
                    
                    console.log('ðŸ—ºï¸ Creating map instance...');
                    
                    // Create the map with forced dimensions
                    mapInstance = L.map(mapContainer, {
                        attributionControl: true,
                        zoomControl: true,
                        scrollWheelZoom: true,
                        doubleClickZoom: true,
                        touchZoom: true,
                        preferCanvas: false
                    }).setView([39.8283, -98.5795], 5);
                    
                    console.log('ðŸ—ºï¸ Adding tile layer...');
                    
                    // Add OpenStreetMap tiles with better error handling
                    const tileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        maxZoom: 19,
                        attribution: 'Â© OpenStreetMap contributors',
                        subdomains: ['a', 'b', 'c'],
                        crossOrigin: true
                    });
                    
                    tileLayer.on('tileerror', function(error) {
                        console.warn('âš ï¸ Tile loading error:', error);
                    });
                    
                    tileLayer.on('load', function() {
                        console.log('âœ… Map tiles loaded successfully');
                    });
                    
                    tileLayer.addTo(mapInstance);
                    
                    // Force map to redraw
                    setTimeout(() => {
                        if (mapInstance) {
                            mapInstance.invalidateSize();
                            console.log('ðŸ”„ Map size invalidated and redrawn');
                        }
                    }, 100);
                    
                    console.log('âœ… Real map initialized successfully');
                } catch (error) {
                    console.error('âŒ Error initializing map:', error);
                    throw error; // Let the backup system handle this
                }
            }
            
            // Clear existing markers
            mapMarkers.forEach(marker => mapInstance.removeLayer(marker));
            mapMarkers = [];
            
            if (!institutions || institutions.length === 0) {
                console.log('âš ï¸ No institutions to display on map');
                if (mapPlaceholder) {
                    mapPlaceholder.style.display = 'none';
                }
                return;
            }
            
            console.log('ðŸ” About to start geocoding process');
            console.log('ðŸ“Š Processing institutions:', {
                total: institutions.length,
                willProcess: Math.min(institutions.length, 10),
                addresses: institutions.slice(0, 10).map(i => i['Full Address'])
            });
            
            // Add markers for each institution with real geocoding
            const bounds = [];
            const institutionsToProcess = institutions.slice(0, 10); // Limit to 10 for performance
            
            // Process institutions in batches to avoid overwhelming the geocoding service
            for (let i = 0; i < institutionsToProcess.length; i++) {
                const inst = institutionsToProcess[i];
                
                try {
                    // Get real coordinates for this institution
                    console.log(`ðŸ” Geocoding institution ${i + 1}/${institutionsToProcess.length}:`, inst['Synagogue Name'], inst['Full Address']);
                    const coords = await getCoordinatesForInstitution(inst, i);
                    
                    if (coords && coords.length === 2 && !isNaN(coords[0]) && !isNaN(coords[1])) {
                        bounds.push(coords);
                        console.log(`âœ… Successfully geocoded ${inst['Synagogue Name']} to:`, coords);
                        
                        // Create custom marker
                        const marker = L.marker(coords, {
                            icon: L.divIcon({
                                className: 'custom-marker',
                                html: `<div class="leaflet-marker-icon">
                                         <i class="fas fa-map-marker-alt"></i>
                                       </div>`,
                                iconSize: [30, 30],
                                iconAnchor: [15, 30]
                            })
                        }).addTo(mapInstance);
                        
                        // Add popup with institution info
                        marker.bindPopup(`
                            <div class="marker-popup">
                                <h4>${inst['Synagogue Name'] || 'Institution'}</h4>
                                <p><strong>${inst.Denomination || 'N/A'}</strong></p>
                                <p><small>${inst['Full Address'] || 'Address not available'}</small></p>
                                <p><small>Phone: ${inst['Phone Number'] || 'N/A'}</small></p>
                            </div>
                        `);
                        
                        mapMarkers.push(marker);
                    } else {
                        console.error(`âŒ Invalid coordinates for ${inst['Synagogue Name']}:`, coords);
                    }
                    
                    // Small delay to be respectful to the geocoding service
                    if (i < institutionsToProcess.length - 1) {
                        await new Promise(resolve => setTimeout(resolve, 200));
                    }
                } catch (error) {
                    console.error(`âŒ Error processing institution ${inst['Synagogue Name']}:`, error);
                }
            }
            
            // Hide loading state
            if (mapPlaceholder) {
                mapPlaceholder.style.display = 'none';
            }
            
            // Fit map to show all markers with optimal zoom
            if (bounds.length > 0) {
                const group = new L.featureGroup(mapMarkers);
                const groupBounds = group.getBounds();
                
                if (bounds.length === 1) {
                    // Single marker - zoom to neighborhood level
                    mapInstance.setView(bounds[0], 14);
                    console.log('ðŸŽ¯ Single marker: Zoomed to level 14');
                } else {
                    // Multiple markers - calculate distance and set appropriate zoom
                    const distance = calculateBoundsDistance(groupBounds);
                    console.log('ðŸ“ Distance between markers:', distance + ' km');
                    
                    let maxZoom;
                    if (distance < 5) {
                        maxZoom = 15; // Very close markers (same neighborhood)
                    } else if (distance < 20) {
                        maxZoom = 13; // Same city
                    } else if (distance < 100) {
                        maxZoom = 11; // Same metro area
                    } else {
                        maxZoom = 9; // Regional view
                    }
                    
                    const fitOptions = {
                        padding: [20, 20], // Small padding for better visibility
                        maxZoom: maxZoom
                    };
                    mapInstance.fitBounds(groupBounds, fitOptions);
                    console.log(`ðŸŽ¯ Multiple markers: Fitted bounds with max zoom ${maxZoom} (distance: ${distance}km)`);
                }
                
                // Force map refresh and visibility
                setTimeout(() => {
                    if (mapInstance) {
                        mapInstance.invalidateSize(true);
                        mapInstance._resetView(mapInstance.getCenter(), mapInstance.getZoom(), true);
                        console.log('ðŸ”„ Forced map refresh after fitting bounds');
                        
                        // Make sure container is visible
                        const mapContainer = document.getElementById('map');
                        if (mapContainer) {
                            mapContainer.style.visibility = 'visible';
                            mapContainer.style.opacity = '1';
                            console.log('ðŸ‘ï¸ Ensured map container visibility');
                        }
                    }
                }, 200);
                
                console.log('ðŸŽ¯ FINAL RESULT: Map fitted to', bounds.length, 'geocoded locations');
                console.log('ðŸ“Š Summary: Processed', institutionsToProcess.length, 'institutions, successfully mapped', mapMarkers.length, 'markers');
                console.log('ðŸ” Current zoom level:', mapInstance.getZoom());
            } else {
                console.warn('âš ï¸ No valid coordinates found for any institution');
            }
        }
        
        // Geocoding cache to avoid repeated API calls
        const geocodeCache = new Map();
        
        // Robust geocoding with multiple fallbacks
        async function getCoordinatesForInstitution(institution, index) {
            try {
                const address = institution['Full Address'];
                if (!address) {
                    console.warn('No address found for:', institution['Synagogue Name']);
                    return getSimpleCoordinates(institution, index);
                }
                
                // Check cache first
                if (geocodeCache.has(address)) {
                    return geocodeCache.get(address);
                }
                
                // Add timeout to geocoding request
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000); // 5 second timeout
                
                try {
                    const encodedAddress = encodeURIComponent(address);
                    const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodedAddress}&limit=1`, {
                        signal: controller.signal
                    });
                    clearTimeout(timeoutId);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    const data = await response.json();
                    
                    if (data && data.length > 0) {
                        const lat = parseFloat(data[0].lat);
                        const lon = parseFloat(data[0].lon);
                        
                        if (isNaN(lat) || isNaN(lon)) {
                            throw new Error('Invalid coordinates returned');
                        }
                        
                        const coords = [lat, lon];
                        geocodeCache.set(address, coords);
                        console.log(`âœ… Geocoded "${address}" to:`, coords);
                        return coords;
                    } else {
                        console.warn('âš ï¸ No geocoding results for:', address);
                        // Fallback to simple coordinates
                        const fallbackCoords = getSimpleCoordinates(institution, index);
                        geocodeCache.set(address, fallbackCoords);
                        return fallbackCoords;
                    }
                } catch (fetchError) {
                    clearTimeout(timeoutId);
                    if (fetchError.name === 'AbortError') {
                        console.warn('â° Geocoding timeout for:', address);
                    } else {
                        console.warn('ðŸŒ Geocoding fetch error for:', address, fetchError.message);
                    }
                    
                    // Fallback to simple coordinates
                    const fallbackCoords = getSimpleCoordinates(institution, index);
                    geocodeCache.set(address, fallbackCoords);
                    return fallbackCoords;
                }
            } catch (error) {
                console.error('âŒ Geocoding error for', institution['Synagogue Name'], ':', error);
                // Final fallback
                return getSimpleCoordinates(institution, index);
            }
        }
        
        // Calculate distance between bounds corners to determine appropriate zoom
        function calculateBoundsDistance(bounds) {
            const corner1 = bounds.getNorthWest();
            const corner2 = bounds.getSouthEast();
            
            // Haversine formula to calculate distance in kilometers
            const R = 6371; // Earth's radius in km
            const dLat = (corner2.lat - corner1.lat) * Math.PI / 180;
            const dLon = (corner2.lng - corner1.lng) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(corner1.lat * Math.PI / 180) * Math.cos(corner2.lat * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return Math.round(R * c * 100) / 100; // Round to 2 decimal places
        }
        
        // Backup map strategy - uses simpler geocoding
        async function initializeBackupMap(institutions) {
            console.log('ðŸ”§ Initializing backup map...');
            const mapContainer = document.getElementById('map');
            const mapPlaceholder = document.getElementById('mapPlaceholder');
            
            // Hide placeholder
            if (mapPlaceholder) {
                mapPlaceholder.style.display = 'none';
            }
            
            // Ensure map exists
            if (!mapInstance) {
                try {
                    mapInstance = L.map(mapContainer).setView([39.8283, -98.5795], 5);
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        maxZoom: 19,
                        attribution: 'Â© OpenStreetMap contributors'
                    }).addTo(mapInstance);
                    console.log('âœ… Backup map base created');
                } catch (error) {
                    throw new Error('Failed to create backup map base: ' + error.message);
                }
            }
            
            // Clear existing markers
            mapMarkers.forEach(marker => mapInstance.removeLayer(marker));
            mapMarkers = [];
            
            if (institutions.length === 0) {
                console.log('ðŸ“ No institutions for backup map');
                return;
            }
            
            // Use simplified coordinate generation for backup
            institutions.slice(0, 10).forEach((inst, index) => {
                try {
                    const coords = getSimpleCoordinates(inst, index);
                    
                    const marker = L.marker(coords, {
                        icon: L.divIcon({
                            className: 'custom-marker',
                            html: `<div class="leaflet-marker-icon">
                                     <i class="fas fa-map-marker-alt"></i>
                                   </div>`,
                            iconSize: [30, 30],
                            iconAnchor: [15, 30]
                        })
                    }).addTo(mapInstance);
                    
                    marker.bindPopup(`
                        <div class="marker-popup">
                            <h4>${inst['Synagogue Name'] || 'Institution'}</h4>
                            <p><strong>${inst.Denomination || 'N/A'}</strong></p>
                            <p><small>${inst['Full Address'] || 'Address not available'}</small></p>
                        </div>
                    `);
                    
                    mapMarkers.push(marker);
                } catch (error) {
                    console.warn('âš ï¸ Failed to add marker for:', inst['Synagogue Name'], error);
                }
            });
            
            // Fit to markers
            if (mapMarkers.length > 0) {
                const group = new L.featureGroup(mapMarkers);
                mapInstance.fitBounds(group.getBounds(), { padding: [20, 20], maxZoom: 13 });
                console.log('âœ… Backup map completed with', mapMarkers.length, 'markers');
            }
        }
        
        // Emergency fallback - always works
        function initializeEmergencyMap(institutions) {
            console.log('ðŸš¨ Initializing emergency fallback map...');
            const mapContainer = document.getElementById('map');
            const mapPlaceholder = document.getElementById('mapPlaceholder');
            
            // Show basic map placeholder with institution list
            const institutionList = institutions.slice(0, 10).map((inst, index) => `
                <div class="emergency-marker" style="margin-bottom: 8px; padding: 8px; background: #f3f4f6; border-radius: 4px;">
                    <strong>${inst['Synagogue Name'] || 'Institution'}</strong><br>
                    <small>${inst['Full Address'] || 'Address not available'}</small>
                </div>
            `).join('');
            
            mapContainer.innerHTML = `
                <div class="emergency-map" style="height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #f9fafb; padding: 20px; text-align: center;">
                    <div style="margin-bottom: 20px;">
                        <i class="fas fa-map-marked-alt" style="font-size: 48px; color: #6b7280; margin-bottom: 16px;"></i>
                        <h3 style="color: #374151; margin-bottom: 8px;">Map View</h3>
                        <p style="color: #6b7280; margin-bottom: 20px;">${institutions.length} institution${institutions.length !== 1 ? 's' : ''} found</p>
                    </div>
                    <div style="width: 100%; max-width: 400px; max-height: 300px; overflow-y: auto;">
                        ${institutionList}
                    </div>
                    <small style="color: #9ca3af; margin-top: 16px;">Interactive map temporarily unavailable</small>
                </div>
            `;
            
            if (mapPlaceholder) {
                mapPlaceholder.style.display = 'none';
            }
            
            console.log('âœ… Emergency map displayed');
        }
        
        // Simple coordinate generation for backup
        function getSimpleCoordinates(institution, index) {
            // Extract state/region from address for basic positioning
            const address = institution['Full Address'] || '';
            const stateCodes = {
                'AL': [32.806671, -86.791130], 'AK': [61.370716, -152.404419], 'AZ': [33.729759, -111.431221],
                'AR': [34.969704, -92.373123], 'CA': [36.116203, -119.681564], 'CO': [39.059811, -105.311104],
                'CT': [41.767, -72.677], 'DE': [39.161921, -75.526755], 'FL': [27.766279, -81.686783],
                'GA': [33.76, -84.39], 'HI': [21.30895, -157.826182], 'ID': [44.240459, -114.478828],
                'IL': [40.349457, -88.986137], 'IN': [39.790942, -86.147685], 'IA': [42.011539, -93.210526],
                'KS': [38.5266, -96.726486], 'KY': [37.669037, -84.670067], 'LA': [31.1801, -91.8749],
                'ME': [44.323535, -69.765261], 'MD': [39.063946, -76.802101], 'MA': [42.2352, -71.0275],
                'MI': [43.326618, -84.536095], 'MN': [45.7326, -93.9196], 'MS': [32.320, -90.207],
                'MO': [38.572954, -92.189283], 'MT': [47.052312, -109.633835], 'NE': [41.12537, -98.268082],
                'NV': [37.839333, -116.46648], 'NH': [43.452492, -71.563896], 'NJ': [40.314039, -74.756138],
                'NM': [34.97273, -105.032363], 'NY': [42.659829, -75.615], 'NC': [35.630066, -79.806419],
                'ND': [47.528912, -99.784012], 'OH': [40.367474, -82.996216], 'OK': [35.482309, -97.534994],
                'OR': [44.931109, -123.029159], 'PA': [40.269789, -76.875613], 'RI': [41.82355, -71.422132],
                'SC': [33.856892, -80.945007], 'SD': [44.2853, -99.4632], 'TN': [35.747845, -86.692345],
                'TX': [31.106, -97.6475], 'UT': [39.419220, -111.950684], 'VT': [44.26639, -72.5804],
                'VA': [37.54, -78.86], 'WA': [47.042418, -120.61878], 'WV': [38.349497, -81.633294],
                'WI': [44.95, -89.5], 'WY': [42.7475, -107.2085]
            };
            
            // Try to find state in address
            let coords = [39.8283, -98.5795]; // Default to center US
            for (const [state, stateCoords] of Object.entries(stateCodes)) {
                if (address.includes(`, ${state} `) || address.includes(`, ${state}`)) {
                    coords = [...stateCoords];
                    break;
                }
            }
            
            // Add small random offset for multiple institutions
            const offset = 0.1;
            coords[0] += (Math.random() - 0.5) * offset;
            coords[1] += (Math.random() - 0.5) * offset;
            
            return coords;
        }
        
        // Show error message if map fails to load
        function showMapError() {
            const mapContainer = document.getElementById('map');
            mapContainer.innerHTML = `
                <div class="map-error">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>Map Loading Error</h3>
                    <p>Unable to load the map. Please refresh the page and try again.</p>
                </div>
            `;
        }
    </script>
    
    <!-- AI Search Configuration -->
    <script>
        // TO ENABLE AI SEARCH WITH CHATGPT:
        // 1. Get an OpenAI API key from https://platform.openai.com/api-keys
        // 2. Replace 'YOUR_OPENAI_API_KEY_HERE' in script.js with your actual API key
        // 3. The AI search will automatically work with natural language queries
        
        // Example queries that will work with AI:
        // - "I'm looking for an Orthodox synagogue with youth programs in Manhattan"
        // - "Find me a Reform temple that has Hebrew school near Brooklyn"
        // - "Conservative synagogue with family programs in the 10001 area"
        // - "Chabad house with adult education classes"
    </script>
</body>
</html> 